define("preload",function(require){var global=require("common/global"),color=require("common/color");return{preload:function(){var game=this.game;!function(game){game.add.text(game.width/2,260,"姜饼人正在路上...",{font:"bold 30px "+global.fontFamily,fill:color.get("white")}).anchor.set(.5);var hero=game.add.sprite(game.width/2,game.height/2,"boy-walk");hero.anchor.set(.5),hero.animations.add("walk"),hero.animations.play("walk",6,!0)}(game),function(game){var path,suffix;suffix="dev"===global.getMode()?(path="src/img/",".png"):(path="asset/img/",".png?v=1544715623"),game.load.image("transparent",path+"transparent"+suffix),game.load.image("transparent-2",path+"transparent-2"+suffix),["black","white","beige","dark-beige"].forEach(function(color){game.load.image("pixel-"+color,path+"pixel/"+color+suffix)}),game.load.image("spot",path+"spot"+suffix),game.load.image("food",path+"food"+suffix),game.load.image("food-with-halo",path+"food-with-halo"+suffix),game.load.image("title",path+"title"+suffix),game.load.image("start",path+"start"+suffix),game.load.image("menu-btn",path+"menu-btn"+suffix),game.load.image("icon-heart",path+"icon-heart"+suffix),game.load.image("icon-hero",path+"icon-hero"+suffix),game.load.image("icon-podium",path+"icon-podium"+suffix),game.load.image("scoreboard",path+"scoreboard"+suffix),game.load.image("popup-edge",path+"popup-edge"+suffix),game.load.image("popup-header",path+"popup-header"+suffix),game.load.image("panel-edge",path+"panel-edge"+suffix),game.load.image("btn-up",path+"btn-up"+suffix),game.load.image("btn-down",path+"btn-down"+suffix),game.load.image("btn-unlock",path+"btn-unlock"+suffix),game.load.image("btn-confirm",path+"btn-confirm"+suffix),game.load.image("me-tip",path+"me-tip"+suffix),game.load.image("end-board",path+"end-board"+suffix),game.load.image("end-btn",path+"end-btn"+suffix),game.load.image("end-btn-share",path+"end-btn-share"+suffix),game.load.image("new-record",path+"new-record"+suffix),game.load.image("end-tip",path+"end-tip"+suffix),game.load.spritesheet("stick",path+"stick"+suffix,5,24),game.load.spritesheet("stick-cold",path+"stick-cold"+suffix,5,24),global.herosConfig.forEach(function(hero){var name=hero.name,actions=hero.actions;for(var action in actions)if(actions.hasOwnProperty(action)){if("boy"===name&&"walk"===action)continue;game.load.spritesheet([name,action].join("-"),path+name+"/"+action+suffix,hero.width,hero.height)}}),[1582,1783,1311].forEach(function(width,index){var no=index+1,dir=path+"view-"+no+"/";game.load.spritesheet("bg-"+no,dir+"bg"+suffix,width,800),game.load.spritesheet("mg-far-"+no,dir+"mg-far"+suffix,width,800),game.load.spritesheet("mg-near-"+no,dir+"mg-near"+suffix,width,800)}),game.load.spritesheet("stage-1",path+"stage-1"+suffix,300,266),game.load.spritesheet("stage-2",path+"stage-2"+suffix,300,243),game.load.spritesheet("stage-3",path+"stage-3"+suffix,300,245),game.load.image("thanks",path+"thanks"+suffix)}(game)},create:function(){global.initFoodCount();var me=this,keys=["highest","selected","unlocks","shared"],storage=global.getStorage(keys),serverKeys=[];for(var key in storage)storage.hasOwnProperty(key)&&null===storage[key]&&serverKeys.push(key);var localKeys=[];keys.forEach(function(key){-1===serverKeys.indexOf(key)&&localKeys.push(key)}),localKeys.length&&global.assignStorage(localKeys),serverKeys.length&&global.initStorage(serverKeys),me.state.start("level",!0,!1,"menu")}}}),define("main",function(require){require("common/global");return{init:function(){var game;(game=new Phaser.Game(480,800,Phaser.CANVAS,"")).state.add("boot",require("boot")),game.state.add("preload",require("preload")),game.state.add("level",require("level/Level")),game.state.start("boot")}}}),define("level/popup/ThanksPopup",function(require){var global=require("common/global"),color=require("common/color"),util=require("common/util"),Popup=require("common/ui/Popup"),ThankPopup=function(game,options){Popup.call(this,game,{hasHeader:!1,height:450}),this._init()};return util.inherits(ThankPopup,Popup),ThankPopup.prototype._initContent=function(){var game=this.game,container=this.container,x=this.containerWidth/2,picture=game.add.image(x,50,"thanks");picture.anchor.set(.5,0),container.addChild(picture);var topEdge=game.add.image(x,picture.y+picture.height+25,"panel-edge");topEdge.anchor.set(.5,0),topEdge.width=300,container.addChild(topEdge);var main=game.add.image(x,topEdge.y+topEdge.height,"pixel-dark-beige");main.anchor.set(.5,0),main.scale.set(300,50),container.addChild(main);var bottomEdge=game.add.image(x,main.y+main.height+topEdge.height,"panel-edge");bottomEdge.anchor.set(.5,0),bottomEdge.scale.y=-1,bottomEdge.width=300,container.addChild(bottomEdge);var text=game.add.text(x,main.y+main.height/2,"献给爱吃甜点的你",{font:"bold 30px "+global.fontFamily,fill:color.get("chocolate"),strokeThickness:7,stroke:color.get("beige")});text.anchor.set(.5),container.addChild(text)},ThankPopup}),define("level/popup/StorePopup",function(require){var global=require("common/global"),color=require("common/color"),util=require("common/util"),Popup=require("common/ui/Popup"),StorePopup=function(game,options){Popup.call(this,game,{hasHeader:!0,headerType:"food",title:"商店",height:382}),this._init()};return util.inherits(StorePopup,Popup),StorePopup.prototype._initContent=function(){var game=this.game,container=this.container,panel={edgeHeight:game.cache.getImage("panel-edge").height,mainHeight:60,width:game.cache.getImage("panel-edge").width,marginTop:20};panel.height=panel.mainHeight+2*panel.edgeHeight;var href=encodeURIComponent(location.href.split("#")[0]);[{food:100,money:.99},{food:250,money:1.99},{food:700,money:4.99}].forEach(function(data,index){var btn=game.add.button(0,(panel.marginTop+panel.height)*index+panel.marginTop,"transparent-2",function(){window.open("http://pay.yiluwan.org/pay-center/index.php?item=000"+(index+6)+"&redirect="+href)});util.addHover(btn),container.addChild(btn);var topEdge=game.add.image(0,0,"panel-edge");btn.addChild(topEdge);var main=game.add.image(0,topEdge.y+panel.edgeHeight,"pixel-dark-beige");main.scale.set(panel.width,panel.mainHeight),btn.addChild(main);var bottomEdge=game.add.image(0,main.y+panel.mainHeight+panel.edgeHeight,"panel-edge");bottomEdge.scale.y=-1,btn.addChild(bottomEdge);var food=game.add.image(30,panel.height/2-4,"food");food.scale.set(.9),food.anchor.set(0,.5),btn.addChild(food);var numberText=game.add.text(210,panel.height/2,"+"+data.food,{font:"bold 30px "+global.fontFamily,fill:color.get("cherry"),strokeThickness:5,stroke:color.get("beige")});numberText.anchor.set(1,.5),btn.addChild(numberText);var moneyText=game.add.text(panel.width-30,panel.height/2,"￥ "+data.money,{font:"bold 26px "+global.fontFamily,fill:color.get("coffee")});moneyText.anchor.set(1,.5),btn.addChild(moneyText)})},StorePopup}),define("level/popup/RankPopup",function(require){var global=require("common/global"),color=require("common/color"),util=require("common/util"),Popup=require("common/ui/Popup"),RankPopup=function(game,options){Popup.call(this,game,{hasHeader:!0,headerType:"icon",headerIcon:"icon-podium",title:"世界排行榜",height:427}),this.rowHeight=65,this._init()};return util.inherits(RankPopup,Popup),RankPopup.prototype._initContent=function(){var me=this;require("common/ajax").get({url:require("common/url").GET_RANK,success:function(res){res=JSON.parse(res),me._preprocessData(res)}})},RankPopup.prototype._preprocessData=function(data){var list,myRank=data.me;5<myRank?(list=data.list.slice(0,4)).push({nickname:global.getNickname(),highest:global.getHighest(),rank:myRank}):list=data.list.slice(0,5),this._initRows(list)},RankPopup.prototype._initRows=function(rankData){var game=this.game,container=this.container,rowHeight=this.rowHeight,rowWidth=this.width-2*this.paddingHorz,myNickname=global.getNickname();rankData.forEach(function(data,index){var row=game.add.image(0,20+rowHeight*index,index%2==0?"pixel-dark-beige":"pixel-black");index%2==0?row.scale.set(rowWidth,rowHeight):(row.scale.set(rowWidth/2,rowHeight/2),row.alpha=0),container.addChild(row);var rowCtn=game.add.image(row.x,row.y);container.addChild(rowCtn);var rankText=game.add.text(15,rowHeight/2,data.rank?9999<data.rank?"9999+":data.rank:index+1,{font:"bold 30px "+global.fontFamily,fill:color.get("coffee"),strokeThickness:6,stroke:color.get("white")});rankText.alpha=.7,rankText.anchor.set(0,.5),data.rank&&99<data.rank&&rankText.scale.set(60/rankText.width),rowCtn.addChild(rankText);var nameText=game.add.text(85,rowHeight/2,data.nickname,{font:"bold 24px "+global.fontFamily,fill:color.get("coffee")});if(nameText.anchor.set(0,.5),rowCtn.addChild(nameText),data.nickname===myNickname){var meTip=game.add.image(nameText.x+nameText.width+10,rowHeight/2,"me-tip");meTip.anchor.set(0,.5),rowCtn.addChild(meTip);var meText=game.add.text(meTip.width-5,0,"me",{font:"bold 18px "+global.fontFamily,fill:color.get("white")});meText.anchor.set(1,.5),meTip.addChild(meText)}var scoreText=game.add.text(rowWidth-15,rowHeight/2,data.highest+"",{font:"bold 26px "+global.fontFamily,fill:color.get("white"),strokeThickness:8,stroke:color.get("coffee")});scoreText.anchor.set(1,.5),rowCtn.addChild(scoreText)})},RankPopup}),define("level/popup/FamilyPopup",function(require){var global=require("common/global"),color=require("common/color"),util=require("common/util"),Popup=require("common/ui/Popup"),FamilyPopup=function(game){Popup.call(this,game,{hasHeader:!0,headerType:"food",title:"超能家族",height:550,paddingBottom:72}),this._init()};return util.inherits(FamilyPopup,Popup),FamilyPopup.prototype._initContent=function(){this._setPanelAttrs(),this._setPagerAttrs(),this._initPanels(),this._initPager()},FamilyPopup.prototype._setPanelAttrs=function(){var game=this.game;this.panel={edgeHeight:game.cache.getImage("panel-edge").height,mainHeight:110,width:game.cache.getImage("panel-edge").width,marginTop:12,dividingX:110,dividingWidth:6};var panel=this.panel;this.panel.height=panel.mainHeight+2*panel.edgeHeight,this.btnSelectList=[],this.btnUnlockList=[]},FamilyPopup.prototype._setPagerAttrs=function(){var heroCount=0;global.herosConfig.forEach(function(config){config.hidden||++heroCount}),this.totalPage=heroCount-2,this.totalPage<1&&(this.totalPage=1),this.page=global.getSelected()+1,this.page>this.totalPage&&(this.page=this.totalPage),this.btnUp=null,this.btnDown=null,this.upActive=!0,this.downActive=!0},FamilyPopup.prototype._initPanels=function(){var container=this.container,me=this,panel=this.panel;container.y-=(panel.height+panel.marginTop)*(this.page-1),global.herosConfig.forEach(function(config,index){if(!config.hidden){var options=me._initPanel(config,index);me._initHero(config,index,options),me._initInfo(config,index,options),me._initBtnSelect(config,index,options),me._initBtnUnlock(config,index,options)}})},FamilyPopup.prototype._initPanel=function(config,index){var game=this.game,container=this.container,panel=this.panel,topEdge=game.add.image(0,(panel.marginTop+panel.height)*index+panel.marginTop,"panel-edge");container.addChild(topEdge);var main=game.add.image(0,topEdge.y+panel.edgeHeight,"pixel-dark-beige");main.scale.set(panel.width,panel.mainHeight),container.addChild(main);var bottomEdge=game.add.image(0,main.y+panel.mainHeight+panel.edgeHeight,"panel-edge");bottomEdge.scale.y=-1,container.addChild(bottomEdge);var dividing=game.add.image(panel.dividingX,topEdge.y,"pixel-beige");dividing.scale.set(panel.dividingWidth,panel.height),container.addChild(dividing);var panelCtn=game.add.image(0,topEdge.y);return container.addChild(panelCtn),{y:topEdge.y,panelCtn:panelCtn}},FamilyPopup.prototype._initHero=function(config,index,options){var game=this.game,panel=this.panel,hero=game.add.sprite(47+config.paddingRight,panel.mainHeight/2-2,config.name+"-down");hero.scale.set(1.1*config.scale),hero.anchor.set(.5),hero.animations.add("down"),hero.animations.play("down",config.actions.down.fps,!0),options.panelCtn.addChild(hero)},FamilyPopup.prototype._isInCurrentPage=function(index){return index>=this.page-1&&index<=this.page+1},FamilyPopup.prototype._initInfo=function(config,index,options){var game=this.game,panel=this.panel,panelCtn=options.panelCtn,nameText=game.add.text(panel.dividingX/2,panel.mainHeight-18,config.chName,{font:"bold 20px "+global.fontFamily,fill:color.get("coffee"),strokeThickness:5,stroke:color.get("white")});nameText.anchor.set(.5,0),nameText.alpha=.7,panelCtn.addChild(nameText);var titleFontStyle={font:"bold 19px "+global.fontFamily,fill:color.get("coffee"),strokeThickness:4,stroke:color.get("beige")},descTitleText=game.add.text(panel.dividingX+panel.dividingWidth+10,10,"简介",titleFontStyle);panelCtn.addChild(descTitleText);var contentFontStyle={font:"17px "+global.fontFamily,fill:color.get("darker-grey")},descText=game.add.text(descTitleText.x+descTitleText.width+6,descTitleText.y+4,config.desc,contentFontStyle);panelCtn.addChild(descText);var powerTilteText=game.add.text(panel.dividingX+panel.dividingWidth+10,descText.y+descText.height+5,"超能",titleFontStyle);panelCtn.addChild(powerTilteText);var powerText=game.add.text(powerTilteText.x+powerTilteText.width+6,powerTilteText.y+4,global.getUnlock(index)?config.powerText:"? ? ?",contentFontStyle);panelCtn.addChild(powerText)},FamilyPopup.prototype._select=function(index){this.game.state.states.level.hero.change(index)},FamilyPopup.prototype._initBtnSelect=function(config,index,options){if(global.getUnlock(index)){var game=this.game,panel=this.panel,btnSelect=game.add.button(0,options.y,"pixel-black",function(){this._select(index),this._hide()},this);btnSelect.scale.set(panel.width/2,panel.height/2),btnSelect.alpha=0,util.addHover(btnSelect,options.panelCtn),this._isInCurrentPage(index)&&global.getUnlock(index)||(btnSelect.visible=!1),this.container.addChild(btnSelect),this.btnSelectList.push(btnSelect)}else this.btnSelectList.push(null)},FamilyPopup.prototype._initBtnUnlock=function(config,index,options){if(global.getUnlock(index))this.btnUnlockList.push(null);else{var game=this.game,panel=this.panel,me=this,btnUnlock=game.add.button(panel.dividingX+panel.dividingWidth,options.y,"btn-unlock",function(){"food"===config.unlockType&&setTimeout(function(){(me._hide(!1),global.getFoodCount()>=config.cost)?new(require("common/ui/Confirm"))(game,{text:"确定用 "+config.cost+" 果果解锁\n【"+config.chName+"】？",onConfirm:function(){global.setFoodCount(global.getFoodCount()-config.cost,function(){global.unlock(index),me._select(index)})}}):new(require("./StorePopup"))(game)},150)},this);switch(btnUnlock.alpha=.7,this._isInCurrentPage(index)||(btnUnlock.visible=!1),this.container.addChild(btnUnlock),this.btnUnlockList.push(btnUnlock),config.unlockType){case"food":var costText=game.add.text(btnUnlock.width/2-8,btnUnlock.height/2,config.cost,{font:"bold 36px "+global.fontFamily,fill:color.get("white")});costText.anchor.set(1,.5),btnUnlock.addChild(costText);var food=game.add.image(btnUnlock.width/2+8,btnUnlock.height/2-5,"food");food.anchor.set(0,.5),food.width=36,food.height=food.width,btnUnlock.addChild(food),util.addHover(btnUnlock);break;case"share":var shareText=game.add.text(btnUnlock.width/2,btnUnlock.height/2,"分享即可获得",{font:"bold 32px "+global.fontFamily,fill:color.get("white")});shareText.anchor.set(.5),btnUnlock.addChild(shareText)}}},FamilyPopup.prototype._initPager=function(){var game=this.game,y=(this.container,game.height+this.height-this.paddingBottom+12),btnDown=game.add.button(game.width/2+10,y,"btn-down",function(){this.downActive&&this._turnPage("down")},this);this.elements.push(btnDown),this.btnDown=btnDown;var btnUp=game.add.button(game.width/2-10-btnDown.width,y,"btn-up",function(){this.upActive&&this._turnPage("up")},this);this.elements.push(btnUp),this.btnUp=btnUp;var me=this;["Down","Up"].forEach(function(type){var events=me["btn"+type].events,activeKey=type.toLowerCase()+"Active";events.onInputDown.add(function(target){me[activeKey]&&(target.alpha=.85)},me),events.onInputUp.add(function(target){me[activeKey]&&(target.alpha=1)},me)}),this._updateBtns()},FamilyPopup.prototype._turnPage=function(type){var panel=this.panel,factor="down"===type?1:-1,offset=-factor*(panel.height+panel.marginTop),turn=this.game.add.tween(this.container).to({y:offset+""},200,Phaser.Easing.Sinusoidal.InOut);turn.onStart.add(function(){this.upActive=!1,this.downActive=!1;var index=this.page+2*factor,comingBtnUnlock=this.btnUnlockList[index];comingBtnUnlock&&(comingBtnUnlock.visible=!0);var comingBtnSelect=this.btnSelectList[index];comingBtnSelect&&(comingBtnSelect.visible=!0)},this),turn.onComplete.add(function(){var index=this.page-factor,currBtnUnlock=this.btnUnlockList[index];currBtnUnlock&&(currBtnUnlock.visible=!1);var currBtnSelect=this.btnSelectList[index];currBtnSelect&&(currBtnSelect.visible=!1),this.page+=factor,this._updateBtns()},this),turn.start()},FamilyPopup.prototype._updateBtns=function(){switch(this.page){case 1:this._disablePagerBtn("up"),this._activatePagerBtn("down");break;case this.totalPage:this._activatePagerBtn("up"),this._disablePagerBtn("down");break;default:this._activatePagerBtn("up"),this._activatePagerBtn("down")}},FamilyPopup.prototype._disablePagerBtn=function(type){this["btn"+type.substr(0,1).toUpperCase()+type.substr(1)].alpha=.5,this[type+"Active"]=!1},FamilyPopup.prototype._activatePagerBtn=function(type){this["btn"+type.substr(0,1).toUpperCase()+type.substr(1)].alpha=1,this[type+"Active"]=!0},FamilyPopup}),define("level/ground/Midground",function(require){var config=require("level/config"),Midground=function(game,options){this.game=game,this.image=null,this.imagePrefix=options.imagePrefix,this.index=options.index,this._init()};return Midground.prototype._init=function(){var game=this.game,imageName=this.imagePrefix+"-"+this.index,image=game.add.tileSprite(0,0,game.cache.getImage(imageName).width,game.height,imageName);(this.image=image).tilePosition.x-=config.themes[this.index].offset},Midground.prototype.scroll=function(offset){this.image.tilePosition.x-=offset},Midground}),define("level/ground/Foreground",function(require){var util=require("common/util"),Foreground=function(game,options){this.game=game,this.objects=options.objects,this.elements=[],this._init()};return Foreground.prototype._init=function(){this.update()},Foreground.prototype.update=function(){var elements=[];this.objects.forEach(function(obj){var el=obj.getEl();el&&(util.isArray(el)?el.forEach(function(item){item&&elements.push(item)}):elements.push(el))}),this.elements=elements},Foreground.prototype.move=function(offsetX,cb){var game=this.game,elements=this.elements;offsetX+="";var len=elements.length;elements.forEach(function(el,index){var move=game.add.tween(el).to({x:offsetX},300,Phaser.Easing.Linear.None);cb&&index===len-1&&move.onComplete.add(cb),move.start()})},Foreground}),define("level/ground/Background",function(require){var config=require("level/config"),Background=function(game,options){this.game=game,this.image=null,this.index=options.index,this._init()};return Background.prototype._init=function(){var game=this.game,imageName="bg-"+this.index,image=game.add.tileSprite(0,0,game.cache.getImage(imageName).width,game.height,imageName);(this.image=image).tilePosition.x-=config.themes[this.index].offset},Background.prototype.scroll=function(){this.image.tilePosition.x-=.3},Background}),define("level/config",function(require){return{themes:{1:{offset:-80},2:{offset:200},3:{offset:100}},initialHorizon:150,horizon:235,currEdgeX:110,foodWidth:25,tips:{play:"按住屏幕\n使棒棒变长",food:"行走时点击屏幕\n可翻转角色吃果果"}}}),define("level/Title",function(require){var Title=function(game){this.game=game,this.image=null,this._init()};return Title.prototype._init=function(){var game=this.game,image=game.add.image(game.width/2,100,"title");image.scale.set(.9),image.anchor.set(.5,0),image.alpha=.75,this.image=image},Title.prototype.destroy=function(){this.image.destroy()},Title}),define("level/Tip",function(require){var global=require("common/global"),color=require("common/color"),Tip=function(game,options){this.game=game,this.text=options.text,this.textText=null,this._init()};return Tip.prototype._init=function(){var game=this.game,textText=game.add.text(game.width/2,135,this.text,{font:"bold 26px "+global.fontFamily,fill:color.get("dark-grey"),align:"center"});textText.alpha=.8,textText.anchor.set(.5,0),this.textText=textText,this._show()},Tip.prototype._show=function(){this.game.add.tween(this.textText).from({alpha:0},300,Phaser.Easing.Quadratic.Out,!0)},Tip.prototype.hide=function(){var hide=this.game.add.tween(this.textText).to({alpha:0},300,Phaser.Easing.Quadratic.In);hide.onComplete.add(function(){this._destroy()},this),hide.start()},Tip.prototype._destroy=function(){this.textText.destroy()},Tip}),define("level/Stick",function(require){var global=require("common/global"),config=require("level/config"),Stick=function(game){this.game=game,this.image=null,this.trash=null,this.updateSpeed(),this.updateTexture(),this.updateExtraLength(),this._init()};return Stick.prototype._init=function(){this.update()},Stick.prototype.update=function(){var game=this.game;this.image&&(this.trash&&this.trash.destroy(!1),this.trash=this.image);var image=game.add.tileSprite(config.currEdgeX,game.height-config.horizon,5,.001,this.texture);image.anchor.set(.5,1),this.image=image},Stick.prototype.setForPlay=function(){var image=this.image;image.height=0,image.angle=0},Stick.prototype.lengthen=function(){this.image.height<this.game.height-config.horizon&&(this.image.height+=this.speed)},Stick.prototype._rotate=function(angle,tweenOptions,cb,cbContext){var rotate=this.game.add.tween(this.image).to({angle:angle},tweenOptions.duration,Phaser.Easing.Quadratic.In,!1,tweenOptions.delay);cb&&rotate.onComplete.add(cb,cbContext),rotate.start()},Stick.prototype.layDown=function(cb,cbContext){this._rotate(90,{duration:400,delay:150},cb,cbContext)},Stick.prototype.fall=function(cb,cbContext){this._rotate(180,{duration:250,delay:100},cb,cbContext)},Stick.prototype.getEl=function(){return[this.image,this.trash]},Stick.prototype.getLength=function(){return this.image.height},Stick.prototype.getFullLength=function(){return this.image.height+this.extraLength},Stick.prototype.isBetween=function(lower,upper){var length=this.getLength();return lower<length&&length<upper},Stick.prototype.isInStage=function(stage){return this.isBetween(stage.getInterval()-this.extraLength,stage.getNextEdgeX()-stage.getCurrEdgeX())},Stick.prototype.isInSpot=function(stage){var spotRange=stage.getSpotRange();return this.isBetween(spotRange.lower,spotRange.upper)},Stick.prototype.updateSpeed=function(){var speed=global.getHeroConfig().power.stickSpeed;this.speed=speed||8},Stick.prototype.updateTexture=function(){var texture=global.getHeroConfig().power.stickTexture;this.texture=texture||"stick"},Stick.prototype.updateExtraLength=function(){var extraLength=global.getHeroConfig().power.stickExtraLength;this.extraLength=extraLength||0},Stick}),define("level/Start",function(require){var global=require("common/global"),color=require("common/color"),util=require("common/util"),Start=function(game,options){this.game=game,this.button=null,this._init(options)};return Start.prototype._init=function(options){var game=this.game,button=game.add.button(game.width/2,400,"start",options.callback,options.context);button.anchor.set(.5),util.addHover(button);var text=game.add.text(0,0,"走 起",{font:"bold 48px "+global.fontFamily,fill:color.get("white")});text.anchor.set(.5),button.addChild(text),this.button=button,this._shake()},Start.prototype._shake=function(){this.game.add.tween(this.button).to({y:"-15"},2e3,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},Start.prototype.destroy=function(){this.button.destroy()},Start}),define("level/Stage",function(require){var global=require("common/global"),util=require("common/util"),config=require("level/config"),Food=require("./Food"),Stage=function(game,options){this.game=game,this.index=options.index,this.imageName="stage-"+this.index,this.prev=null,this.curr=null,this.next=null,this.spot=null,this.oldFood=null,this.food=null,this.moveEasing=Phaser.Easing.Linear.None,this.height=game.cache.getImage(this.imageName).height,this.currEdgeX=config.currEdgeX,this.maxWidth=this.currEdgeX,this.updateMinWidth(),this.updateFoodProba(),this.updateSpotMultiple(),this.updateSpotWidth(),this._init()};return Stage.prototype._init=function(){var game=this.game;this.curr=game.add.tileSprite((game.width-this.maxWidth)/2,game.height-config.initialHorizon-(this.height-config.horizon),this.maxWidth,this.height,this.imageName)},Stage.prototype.setForPlay=function(useTween,cb){var game=this.game,nextWidth=this.maxWidth,next=game.add.tileSprite(game.width,game.height-this.height,nextWidth,this.height,this.imageName);this._randomTilePosition(next),this.next=next,this.spot=this._createSpot(next);var currY=game.height-this.height,nextX=this.currEdgeX+game.rnd.between(40,180),easing=this.moveEasing;if(useTween){var moveCurr=game.add.tween(this.curr).to({x:0,y:currY},200,easing),moveNext=game.add.tween(next).to({x:nextX},200,easing);cb&&moveNext.onComplete.add(cb),moveCurr.chain(moveNext),moveCurr.start()}else{var curr=this.curr;curr.x=0,curr.y=currY,next.x=nextX}},Stage.prototype._randomTilePosition=function(pillar){pillar.tilePosition.x=-this.game.rnd.between(0,300-this.maxWidth)},Stage.prototype._createSpot=function(pillar){var spot=this.game.add.image(pillar.width/2,this.height-config.horizon,"spot");return spot.width=this.spotWidth,spot.anchor.set(.5,0),pillar.addChild(spot),spot},Stage.prototype._createFood=function(){var game=this.game;return new Food(game,{x:game.width,y:game.height-config.horizon+10})},Stage.prototype.addNext=function(cb){var game=this.game,nextWidth=game.rnd.between(this.minWidth,this.maxWidth),nextMargin=[20,10],nextX=game.rnd.between(this.currEdgeX+nextMargin[0],game.width-nextWidth-nextMargin[1]),foodWidth=config.foodWidth,food=null,foodX=nextX,hasFood=util.proba(this.foodProba)&&nextX-this.currEdgeX>=foodWidth+20;hasFood&&(foodX=game.rnd.between(this.currEdgeX+10,nextX-10-foodWidth),food=this._createFood(),game.add.tween(food.getEl()).to({x:foodX},300,this.moveEasing).start());var next=game.add.tileSprite(game.width+nextX-foodX,game.height-this.height,nextWidth,this.height,this.imageName);this._randomTilePosition(next);var spot=this._createSpot(next),move=game.add.tween(next).to({x:nextX},300,this.moveEasing);return move.onComplete.add(function(){this.prev&&this.prev.destroy(),this.prev=this.curr,this.curr=this.next,this.next=next,this.spot=spot,this.oldFood&&this.oldFood.destroy(),this.oldFood=this.food,this.food=food||null,cb&&cb()},this),move.start(),{hasFood:hasFood}},Stage.prototype.getCurrEdgeX=function(){return this.currEdgeX},Stage.prototype.getNextEdgeX=function(){var next=this.next;return next.x+next.width},Stage.prototype.getEl=function(){var el=[this.prev,this.curr,this.next];return[this.oldFood,this.food].forEach(function(item){item&&el.push(item.getEl())}),el},Stage.prototype.getInterval=function(){var curr=this.curr;return this.next.x-curr.x-curr.width},Stage.prototype.getSpotX=function(){return this.next.x+this.spot.x},Stage.prototype.getSpotRange=function(){var lower=this.getSpotX()-this.currEdgeX-this.spotWidth/2;return{lower:lower,upper:lower+this.spotWidth}},Stage.prototype.getFood=function(){return this.food},Stage.prototype.getSpotMultiple=function(){return this.spotMultiple},Stage.prototype.updateFoodProba=function(){var foodProba=global.getHeroConfig().power.foodProba;this.foodProba=foodProba||.5},Stage.prototype.updateMinWidth=function(){var minWidth=global.getHeroConfig().power.stageMinWidth;this.minWidth=minWidth||24},Stage.prototype.updateSpotMultiple=function(){var spotMultiple=global.getHeroConfig().power.spotMultiple;this.spotMultiple=spotMultiple||1},Stage.prototype.updateSpotWidth=function(){var spotWidth=global.getHeroConfig().power.spotWidth;this.spotWidth=spotWidth||14},Stage}),define("level/Scoreboard",function(require){var global=require("common/global"),color=require("common/color"),Scoreboard=function(game){this.game=game,this.score=0,this.text=null,this.board=null,this._init()};return Scoreboard.prototype._init=function(){var game=this.game,board=game.add.image(game.width/2,85,"scoreboard");board.anchor.set(.5),this.board=board;var text=game.add.text(0,2,this.score+"",{font:"bold 48px "+global.fontFamily,fill:color.get("white")});text.anchor.set(.5),board.addChild(text),this.text=text},Scoreboard.prototype.getScore=function(){return this.score},Scoreboard.prototype.addScore=function(value){this.score+=value;var text=this.text;text.text=this.score+"";var game=this.game,easingQuadratic=Phaser.Easing.Quadratic,largen=game.add.tween(text.scale).to({x:1.2,y:1.2},200,easingQuadratic.Out),recover=game.add.tween(text.scale).to({x:1,y:1},200,easingQuadratic.In);largen.chain(recover),largen.start()},Scoreboard}),define("level/Praise",function(require){var global=require("common/global"),color=require("common/color"),config=require("level/config"),Praise=function(game,options){this.game=game,this.pointsText=null,this.praiseText=null,this.points=options.points,this.pointsX=options.pointsX,this._init()};return Praise.prototype._init=function(){var game=this.game,pointsText=game.add.text(this.pointsX,game.height-config.horizon,"+"+this.points,{font:"bold 20px "+global.fontFamily,fill:color.get("dark-grey")});pointsText.anchor.set(.5,1),pointsText.alpha=0,this.pointsText=pointsText;var sentences=["赞 哟 !","好 棒 !","└(^o^)┘"],praiseText=game.add.text(game.width/2,230,sentences[game.rnd.between(0,sentences.length-1)],{font:"bold 36px "+global.fontFamily,fill:color.get("dark-grey")});praiseText.anchor.set(.5,0),praiseText.alpha=0,this.praiseText=praiseText,this._tween()},Praise.prototype._tween=function(){var game=this.game,pointsText=this.pointsText,showPoints=game.add.tween(pointsText).to({alpha:.8},350,Phaser.Easing.Quadratic.Out,!1),hidePoints=game.add.tween(pointsText).to({alpha:0},350,Phaser.Easing.Quadratic.In,!1),risePoints=game.add.tween(pointsText).to({y:"-20"},700,Phaser.Easing.Linear.None,!1);risePoints.onComplete.add(function(){pointsText.destroy()}),showPoints.chain(hidePoints),showPoints.start(),risePoints.start();var praiseText=this.praiseText,showPraise=game.add.tween(praiseText).to({alpha:.8},400,Phaser.Easing.Quadratic.Out,!1),hidePraise=game.add.tween(praiseText).to({alpha:0},400,Phaser.Easing.Quadratic.In,!1,300);hidePraise.onComplete.add(function(){praiseText.destroy()}),showPraise.chain(hidePraise),showPraise.start()},Praise}),define("level/MenuBtns",function(require){var global=require("common/global"),color=require("common/color"),util=require("common/util"),MenuBtns=function(game){this.game=game,this.group=game.add.group(),this._init()};return MenuBtns.prototype._init=function(){var game=this.game,btnConfigs=[{position:"right",icon:"food",title:"商店",onClick:function(){new(require("./popup/StorePopup"))(game)}},{position:"right",icon:"icon-hero",title:"角色",onClick:function(){new(require("./popup/FamilyPopup"))(game)}},{position:"left",icon:"icon-heart",title:"致谢",onClick:function(){new(require("./popup/ThanksPopup"))(game)}},{position:"left",icon:"icon-podium",title:"排名",onClick:function(){new(require("./popup/RankPopup"))(game)}}],btnWidth=game.cache.getImage("menu-btn").width,bottom=50+btnWidth/2,posConfig={};posConfig.left={index:0,x:30+btnWidth/2,titleX:btnWidth/2+8,titleAnchorX:0},posConfig.right={index:0,x:game.width-posConfig.left.x,titleX:-btnWidth/2-8,titleAnchorX:1};var group=this.group;btnConfigs.forEach(function(config){var pos=config.position,btn=game.add.button(posConfig[pos].x,game.height-bottom-70*posConfig[pos].index,"menu-btn",config.onClick);btn.anchor.set(.5),util.addHover(btn),group.add(btn);var icon=game.add.image(0,0,config.icon);icon.anchor.set(.5),icon.width=34,icon.height=icon.width,btn.addChild(icon);var title=game.add.text(posConfig[pos].titleX,0,config.title,{font:"bold 28px "+global.fontFamily,fill:color.get("white")});title.anchor.set(posConfig[pos].titleAnchorX,.5),title.alpha=.8,title.setShadow(1,1,"#000",4),btn.addChild(title),++posConfig[pos].index})},MenuBtns.prototype.destroy=function(){this.group.destroy()},MenuBtns}),define("level/Level",function(require){var global=require("common/global"),config=require("level/config"),Background=require("./ground/Background"),Midground=require("./ground/Midground"),Foreground=require("./ground/Foreground"),Fog=require("./Fog"),Start=require("./Start"),MenuBtns=require("./MenuBtns"),Title=require("./Title"),End=require("./End"),Stage=require("./Stage"),Hero=require("./Hero"),Stick=require("./Stick"),Scoreboard=require("./Scoreboard"),Foodboard=require("./Foodboard"),Tip=require("./Tip"),Praise=require("./Praise"),Combo=require("./Combo"),level={};function onInputDown(){var hero=this.hero;this.isHoldEnabled&&(this.isBeingHeld=!0,hero.up()),this.isTouchEnabled&&hero.flip()}function onInputUp(){this.isHoldEnabled&&this.isBeingHeld&&(this.isBeingHeld=!1,this.isHoldEnabled=!1,this.hero.kick(),this._layDownStick())}return level.init=function(status){this.status=status},level.create=function(){switch(this._reset(),this.status){case"menu":this._initMenuStatus();break;case"play":this._initPlayStatus()}this._transition()},level.update=function(){if(this.background.scroll(),"play"===this.status){this.shouldMgScroll&&(this.nearMidground.scroll(2),this.farMidground.scroll(1)),this.isHoldEnabled&&this.isBeingHeld&&this.stick.lengthen();var food=this.stage.getFood();food&&food.isStartingBeingEaten(this.hero)&&(this.isFoodToBeAdded=!0)}},level._reset=function(){this.isHoldEnabled=!1,this.isBeingHeld=!1,this.isTouchEnabled=!1,this.isFoodToBeAdded=!1,this.shouldMgScroll=!1,this.theme=this.game.rnd.between(1,3),global.resetShareText(),require("common/weixin").updateShare()},level._transition=function(){new(require("common/ui/Mask"))(this.game,{alpha:1}).hide(150)},level._initView=function(){var game=this.game;this.background=new Background(game,{index:this.theme}),this.farMidground=new Midground(game,{index:this.theme,imagePrefix:"mg-far"}),this.nearMidground=new Midground(game,{index:this.theme,imagePrefix:"mg-near"}),this.fog=new Fog(game)},level._initBaseObjs=function(){this._initView();var game=this.game;this.stage=new Stage(game,{index:this.theme}),this.hero=new Hero(game,{index:global.getSelected()})},level._initMenuStatus=function(){this._initBaseObjs();var game=this.game;this.start=new Start(game,{callback:this._initPlayStatus,context:this}),this.menuBtns=new MenuBtns(game),this.title=new Title(game)},level._initPlayStatus=function(){var game=this.game;switch(this.status){case"play":this._initBaseObjs(),this.hero.setForPlay(!1),this.stage.setForPlay(!1),this.isHoldEnabled=!0;break;case"menu":[this.title,this.start,this.menuBtns].forEach(function(item){item.destroy()}),this.hero.setForPlay(!0);var me=this;this.stage.setForPlay(!0,function(){me.status="play",me.isHoldEnabled=!0})}this.scoreboard=new Scoreboard(game),this.foodboard=new Foodboard(game),this.stick=new Stick(game),this.foreground=new Foreground(game,{objects:[this.stage,this.hero,this.stick]}),global.getHighest()<2&&(this.playTip=new Tip(game,{text:config.tips.play})),this.combo=new Combo(game),this._bindTouch()},level._bindTouch=function(){var game=this.game;game.input.onDown.add(onInputDown,this),game.input.onUp.add(onInputUp,this)},level._layDownStick=function(){var stick=this.stick,me=this;stick.layDown(function(){me.isTouchEnabled=!0;var stage=me.stage;if(stick.getFullLength()>stage.getInterval()){var combo=me.combo;if(stick.isInSpot(stage)){var points=stage.getSpotMultiple()*combo.get();me.scoreboard.addScore(points),combo.add(),new Praise(me.game,{points:points,pointsX:stage.getSpotX()})}else combo.reset();me._makeHeroWalkToNext()}else me._makeHeroWalkToStickEnd()})},level._makeHeroWalkToNext=function(){var me=this,hero=this.hero,stage=this.stage;hero.walk(stage.getCurrEdgeX()+stage.getInterval(),function(){me.isTouchEnabled=!1,hero.isUpsideDown()?me._fail():me.stick.isInStage(stage)?([me.playTip,me.foodTip].forEach(function(tip){tip&&(tip.hide(),tip=null)}),me._makeHeroWalkToNextEdge()):me._makeHeroWalkToStickEnd()})},level._makeHeroWalkToNextEdge=function(){var me=this,stage=this.stage,nextEdgeX=stage.getNextEdgeX();this.hero.walk(nextEdgeX,function(){me.scoreboard.addScore(1),me.isFoodToBeAdded&&(me.isFoodToBeAdded=!1,global.setFoodCount(global.getFoodCount()+1),me.foodboard.update()),me.shouldMgScroll=!0;var foreground=me.foreground;foreground.move(stage.getCurrEdgeX()-nextEdgeX,function(){me.shouldMgScroll=!1});var options=stage.addNext(function(){me.stick.update(),foreground.update(),me.isHoldEnabled=!0});!global.getFoodCount()&&options.hasFood&&(me.foodTip=new Tip(me.game,{text:config.tips.food}))})},level._makeHeroWalkToStickEnd=function(){var me=this;this.hero.walk(this.stage.getCurrEdgeX()+this.stick.getLength()+12,function(){me.isTouchEnabled=!1,me._fail()})},level._fail=function(){var me=this,highest=global.getHighest(),score=this.scoreboard.getScore(),hasNewRecord=highest<score;hasNewRecord&&global.setHighest(score);var stick=this.stick;stick.fall();var hero=this.hero;hero.fall(function(){me.game.plugins.screenShake.shake(10),setTimeout(function(){hero.power.doubleLife?(hero.sustainLife(),stick.setForPlay(),hero.twinkle(),me.isHoldEnabled=!0):new End(me.game,{score:score,hasNewRecord:hasNewRecord})},400)})},level}),define("level/Hero",function(require){var global=require("common/global"),config=require("level/config"),Hero=function(game,options){this.game=game,this.index=options.index,this.sprite=null,this.upsideDown=!1,this._init()};return Hero.prototype._init=function(){this._initConfig(),this._initSprite()},Hero.prototype._initConfig=function(){var heroConfig=require("common/global").herosConfig[this.index];for(var key in heroConfig)heroConfig.hasOwnProperty(key)&&(this[key]=heroConfig[key])},Hero.prototype._initSprite=function(){var game=this.game,sprite=game.add.sprite((game.width+this.width*this.scale)/2,game.height-config.initialHorizon);sprite.scale.set(this.scale),sprite.anchor.set(1,1),this.sprite=sprite,this.down()},Hero.prototype.setForPlay=function(useTween,cb){var game=this.game,x=config.currEdgeX+this.paddingRight,y=game.height-config.horizon;if(useTween){var move=game.add.tween(this.sprite).to({x:x,y:y},200,Phaser.Easing.Linear.None);move.onComplete.add(function(){this.down(),cb&&cb()},this),this._act("walk",!0),move.start()}else{var sprite=this.sprite;sprite.x=x,sprite.y=y}},Hero.prototype._act=function(action,loop){var sprite=this.sprite,key=[this.name,action].join("-");sprite.key!==key&&(sprite.loadTexture(key),!sprite.animations.getAnimation(action)&&sprite.animations.add(action),sprite.animations.play(action,this.actions[action].fps,!!loop))},Hero.prototype.down=function(){this._act("down",!0)},Hero.prototype.up=function(){this._act("up",!0)},Hero.prototype.kick=function(){this._act("kick")},Hero.prototype.walk=function(targetX,cb){var game=this.game,sprite=this.sprite;sprite.bringToTop();var maxX=game.width;maxX<(targetX+=this.paddingRight)&&(targetX=maxX);var duration=3*(targetX-sprite.x),move=game.add.tween(sprite).to({x:targetX},duration,Phaser.Easing.Linear.None);move.onComplete.add(function(){this.down(),cb&&cb()},this),this._act("walk",!0),move.start()},Hero.prototype.getEl=function(){return this.sprite},Hero.prototype.fall=function(cb){var game=this.game,fall=game.add.tween(this.sprite).to({y:game.height+(this.upsideDown?0:this.height)},300,Phaser.Easing.Quadratic.In,!1,100);cb&&fall.onComplete.add(cb),fall.start()},Hero.prototype.flip=function(){this.sprite.scale.y*=-1,this.upsideDown=!this.upsideDown},Hero.prototype.isUpsideDown=function(){return this.upsideDown},Hero.prototype.getX=function(){return this.sprite.x},Hero.prototype.getWidth=function(){return this.sprite.width},Hero.prototype.change=function(index,temporary){global.setSelected(index,!temporary),this.index=index,this._initConfig();var game=this.game,sprite=this.sprite;sprite.x=(game.width+this.width*this.scale)/2,sprite.y=game.height-config.initialHorizon,sprite.scale.set(this.scale),this.down();var level=game.state.states.level,stick=level.stick;stick&&(stick.updateSpeed(),stick.updateTexture(),stick.updateExtraLength());var stage=level.stage;stage.updateFoodProba(),stage.updateMinWidth(),stage.updateSpotMultiple(),stage.updateSpotWidth(),temporary&&global.setSelected(this.power.previousLife,!1)},Hero.prototype.sustainLife=function(){this.change(this.power.nextLife,!0),this.setForPlay(!1)},Hero.prototype.twinkle=function(cb){var twinkle=this.game.add.tween(this.sprite).from({alpha:0},200,Phaser.Easing.Linear.None,!0,0,1,!0);cb&&twinkle.onComplete.add(cb),twinkle.start()},Hero}),define("level/Foodboard",function(require){var global=require("common/global"),color=require("common/color"),Foodboard=function(game){this.game=game,this.text=null,this.legend=null,this._init()};return Foodboard.prototype._init=function(){var game=this.game,text=game.add.text(game.width-63,20,global.getFoodCount()+"",{font:"bold 30px "+global.fontFamily,fill:color.get("white")});text.anchor.set(1,.5),text.y+=text.height/2,this.text=text;var legend=game.add.image(game.width-20,18,"food");legend.width=35,legend.height=legend.width,legend.anchor.set(1,0),this.legend=legend},Foodboard.prototype.update=function(){var text=this.text;text.text=global.getFoodCount()+"";var game=this.game,easingQuadratic=Phaser.Easing.Quadratic,largen=game.add.tween(text.scale).to({x:1.2,y:1.2},200,easingQuadratic.Out),recover=game.add.tween(text.scale).to({x:1,y:1},200,easingQuadratic.In);largen.chain(recover),largen.start()},Foodboard}),define("level/Food",function(require){var config=require("level/config"),Food=function(game,options){this.game=game,this.image=null,this.isEaten=!1,this.shaking=null,this._init(options)};return Food.prototype._init=function(options){var game=this.game,padding=(game.cache.getImage("food-with-halo").width-config.foodWidth)/2;this.image=game.add.image(options.x-padding,options.y-padding,"food-with-halo"),this._shake()},Food.prototype._shake=function(){this.shaking=this.game.add.tween(this.image).to({y:"8"},1500,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},Food.prototype._stopShaking=function(){this.shaking.stop()},Food.prototype.destroy=function(){this.image.destroy()},Food.prototype.getEl=function(){return this.image},Food.prototype.isStartingBeingEaten=function(hero){if(this.isEaten||!hero.isUpsideDown())return!1;var image=this.image,foodLeft=image.x,foodRight=image.x+image.width,heroRight=hero.getX(),heroLeft=heroRight-hero.getWidth();return foodLeft<heroRight&&heroLeft<foodRight&&(this.beEaten(),!0)},Food.prototype.beEaten=function(){this.isEaten=!0,this._stopShaking();var image=this.image;image.anchor.set(.5),image.x+=image.width/2,image.y+=image.height/2;var vanish=this.game.add.tween(image.scale).to({x:0,y:0},100,Phaser.Easing.Quadratic.In);vanish.onComplete.add(function(){this.destroy()},this),vanish.start()},Food}),define("level/Fog",function(require){var Fog=function(game,options){this.game=game,this.image=null,this._init()};return Fog.prototype._init=function(){var game=this.game,image=game.add.image(0,0,"pixel-white");image.scale.set(game.width/image.width,game.height/image.height),image.alpha=.15,this.image=image},Fog}),define("level/End",function(require){var global=require("common/global"),color=require("common/color"),util=require("common/util"),Mask=require("common/ui/Mask"),End=function(game,options){this.game=game,this.mask=null,this.body=null,this.score=options.score,this.hasNewRecord=options.hasNewRecord,this._init()};return End.prototype._init=function(){this._initMask(),this._initBody(),this._initBoard(),this._initTitle(),this._initBtns(),0!==global.getSelected()||this.hasNewRecord?global.resetTryTimes():(global.addTryTimes(),3<=global.getTryTimes()&&(this._initTip(),global.resetTryTimes())),this._show(),this._updateShare()},End.prototype._initMask=function(){var Mask=require("common/ui/Mask");this.mask=new Mask(this.game,{alpha:.6})},End.prototype._initBody=function(){var game=this.game,body=game.add.image(game.width/2,80);body.anchor.set(.5,0),this.body=body},End.prototype._initTitle=function(){var title=this.game.add.text(0,0,"结束啦",{font:"bold 50px "+global.fontFamily,fill:color.get("white")});title.anchor.set(.5,0),this.body.addChild(title)},End.prototype._initBoard=function(){var game=this.game,body=this.body,board=game.add.image(0,90,"end-board");board.anchor.set(.5,0),body.addChild(board);var titleFontStyle={font:"22px "+global.fontFamily,fill:color.get("black")},scoreTitle=game.add.text(0,15,"分数",titleFontStyle);scoreTitle.anchor.set(.5,0),board.addChild(scoreTitle);var highestTitle=game.add.text(0,108,"最佳",titleFontStyle);highestTitle.anchor.set(.5,0),board.addChild(highestTitle);var valueFontStyle={font:"bold 46px "+global.fontFamily,fill:color.get("black")},scoreValue=game.add.text(0,45,this.score+"",valueFontStyle);scoreValue.anchor.set(.5,0),board.addChild(scoreValue);var hightest=global.getHighest(),highestValue=game.add.text(0,138,hightest+"",valueFontStyle);if(highestValue.anchor.set(.5,0),board.addChild(highestValue),this.hasNewRecord){var newRecord=game.add.image(scoreTitle.x+scoreTitle.width/2+18,scoreTitle.y,"new-record");board.addChild(newRecord);var newRecordText=game.add.text(newRecord.x+newRecord.width/2,newRecord.y+16,"新纪录",{font:"bold 18px "+global.fontFamily,fill:color.get("white")});newRecordText.anchor.set(.5),board.addChild(newRecordText)}},End.prototype._transition=function(cb){new Mask(this.game,{alpha:1}).show(150,cb)},End.prototype._initBtns=function(){var me=this,game=this.game,body=this.body;[{texture:"end-btn-share",text:"炫耀一下",onClick:function(){var mask=new Mask(this.game,{alpha:.6});mask.show(150);var tipText=game.add.text(game.width/2,200,"点击右上角\n分享到朋友圈",{font:"bold 42px "+global.fontFamily,fill:color.get("white"),align:"center"});tipText.anchor.set(.5,0);Phaser.Easing.Quadratic.InOut;game.add.tween(tipText).from({alpha:0},150,this.ease,!0),setTimeout(function(){mask.hide(400);var hideTip=game.add.tween(tipText).to({alpha:0},400,this.ease);hideTip.onComplete.add(function(){tipText.destroy()}),hideTip.start()},800)}},{texture:"end-btn",text:"返回菜单",onClick:function(){me._transition(function(){game.state.start("level",!0,!1,"menu")})}},{texture:"end-btn",text:"再玩一次",onClick:function(){me._transition(function(){game.state.start("level",!0,!1,"play")})}}].forEach(function(config,index){var btn=game.add.button(0,360+80*index,config.texture,config.onClick);btn.anchor.set(.5),util.addHover(btn),body.addChild(btn);var text=game.add.text(0,3,config.text,{font:"bold 30px "+global.fontFamily,fill:color.get("end-btn"===config.texture?"coffee":"white")});text.anchor.set(.5),btn.addChild(text)})},End.prototype._initTip=function(){var game=this.game,tip=game.add.image(114,360,"end-tip");this.body.addChild(tip);var text=game.add.text(8,7,"换个角色\n试试",{font:"bold 20px "+global.fontFamily,fill:color.get("white"),align:"center"});tip.addChild(text),game.add.tween(tip).to({y:"-5"},1e3,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},End.prototype._show=function(){this.mask.show(500),this.game.add.tween(this.body).from({alpha:0},500,Phaser.Easing.Quadratic.InOut,!0)},End.prototype._updateShare=function(){global.setShareText("我的『"+global.getHeroConfig().chName+"』勇闯了"+this.score+"道甜点关，你也来试试吧！"),require("common/weixin").updateShare()},End}),define("level/Combo",function(require){var global=require("common/global"),color=require("common/color"),Combo=function(game){this.game=game,this.count=0,this.body=null,this.countText=null,this._init()};return Combo.prototype._init=function(){var game=this.game,body=game.add.image(20,168);body.alpha=0,this.body=body;var label=game.add.text(0,0,"COMBO",{font:"bold 36px "+global.fontFamily,fill:color.get("orange"),strokeThickness:8,stroke:color.get("white")});label.anchor.set(0,.5),body.addChild(label);var multipleSign=game.add.text(label.width+5,0,"×",{font:"bold 36px "+global.fontFamily,fill:color.get("white")});multipleSign.anchor.set(0,.5),body.addChild(multipleSign);var countText=game.add.text(multipleSign.x+multipleSign.width+18,0,this.count+"",{font:"bold 36px "+global.fontFamily,fill:color.get("cherry"),strokeThickness:8,stroke:color.get("white")});countText.anchor.set(.5),this.countText=countText,body.addChild(countText)},Combo.prototype.get=function(){return this.count},Combo.prototype._show=function(){this.game.add.tween(this.body).to({alpha:1},300,Phaser.Easing.Quadratic.Out,!0)},Combo.prototype._hide=function(cb){this.game.add.tween(this.body).to({alpha:0},300,Phaser.Easing.Quadratic.In,!0)},Combo.prototype.add=function(){this.count||this._show();var countText=this.countText;countText.text=++this.count+"";var game=this.game,easingQuadratic=Phaser.Easing.Quadratic,largen=game.add.tween(countText.scale).to({x:1.5,y:1.5},200,easingQuadratic.Out),recover=game.add.tween(countText.scale).to({x:1,y:1},200,easingQuadratic.In);largen.chain(recover),largen.start()},Combo.prototype.reset=function(){this.count&&(this._hide(),this.count=0)},Combo}),define("common/weixin",function(require){var global=require("common/global");function updateShare(){var link="http://mp.weixin.qq.com/s?__biz=MzAwODMwMzA0Mw==&mid=206193292&idx=1&sn=2eb2c175488e2432921a3609af7ca185&scene=2&from=timeline&isappinstalled=0#rd",imgUrl="http://farm.yiluwan.org/super-gingerbread/asset/img/icon-200.png";wx.onMenuShareTimeline({title:global.getShareText(),link:link,imgUrl:imgUrl,success:function(){global.setShared(1),global.unlock(1)}}),wx.onMenuShareAppMessage({title:"超能姜饼人",desc:global.getShareText(),link:link,imgUrl:imgUrl})}return{init:function(color){var signPackage=global.getSignPackage();signPackage.jsApiList=["onMenuShareTimeline","onMenuShareAppMessage"],wx.config(signPackage),wx.ready(function(){updateShare()})},updateShare:updateShare}}),define("common/util",function(require){var util={isArray:function(item){return"Array"===Object.prototype.toString.call(item).slice(8,-1)},proba:function(p){p=10*p||1;var odds=Math.floor(10*Math.random());return 1===p||odds<p},inherits:function(type,superType){var Empty=function(){};Empty.prototype=superType.prototype;var proto=new Empty,originalPrototype=type.prototype;for(var key in type.prototype=proto,originalPrototype)proto[key]=originalPrototype[key];return type.prototype.constructor=type},addHover:function(btn,target){var events=btn.events,originAlpha=(target=target||btn).alpha;events.onInputDown.add(function(){target.alpha=.8*originAlpha}),events.onInputUp.add(function(){target.alpha=originAlpha})},firstToUpperCase:function(str){return str.substr(0,1).toUpperCase()+str.substr(1)}};return util}),define("common/url",function(){var workSpace="http://farm.yiluwan.org/super-gingerbread/";return{GET_SIGNATURE:"http://www.yiluwan.org/ecomui/xiaoyouxi?controller=ajax&action=gettoken",USE_FOOD:workSpace+"food.php?type=minus",ADD_FOOD:workSpace+"food.php?type=plus",LOAD_DATA:workSpace+"storage.php",SAVE_DATA:workSpace+"storage.php",GET_RANK:workSpace+"rank.php"}}),define("common/ui/Popup",function(require){var global=require("common/global"),color=require("common/color"),Popup=function(game,options){options||(options={}),this.game=game,this.mask=null,this.body=null,this.header=null,this.container=null,this.main=null,this.topEdge=null,this.bottomEdge=null,this.elements=[],this.hasHeader=!!options.hasHeader,this.headerType=options.headerType?options.headerType:"",this.headerIcon=options.headerIcon?options.headerIcon:"",this.width=game.cache.getImage("popup-edge").width,this.height=options.height?options.height:520,this.y=options.y?options.y:120,this.paddingHorz=12,this.paddingTop=30,this.paddingBottom=options.paddingBottom?options.paddingBottom:30,this.containerWidth=this.width-2*this.paddingHorz,this.containerHeight=0,this.title=options.title?options.title:""};return Popup.prototype._init=function(){this._initMask(),this._initBody(),this.hasHeader&&this._initHeader(),this._initContainer(),this._initContent(),this._show()},Popup.prototype._initMask=function(){var me=this,Mask=require("common/ui/Mask");this.mask=new Mask(this.game,{alpha:.3,onTouch:function(){me._hide()}})},Popup.prototype._initBody=function(){var game=this.game,body=game.add.image(game.width/2,game.height);body.anchor.set(.5,0),body.inputEnabled=!0,this.body=body,this.elements.push(body);var topEdge=game.add.image(0,0,"popup-edge");topEdge.anchor.set(.5,0),body.addChild(topEdge);var edgeHeight=(this.topEdge=topEdge).height,main=game.add.image(0,edgeHeight,"pixel-beige");main.scale.set(this.width,this.height-2*edgeHeight),main.anchor.set(.5,0),body.addChild(main),this.main=main;var bottomEdge=game.add.image(0,2*edgeHeight+main.height,"popup-edge");bottomEdge.scale.y=-1,bottomEdge.anchor.set(.5,0),body.addChild(bottomEdge),this.bottomEdge=bottomEdge},Popup.prototype._initHeader=function(){var game=this.game,header=game.add.image(-this.width/2,game.cache.getImage("popup-header").height/2,"popup-header");header.anchor.set(0,.5),this.body.addChild(header),this.header=header;var titleText=game.add.text(12,3,this.title,{font:"bold 30px "+global.fontFamily,fill:color.get("white")});switch(titleText.anchor.set(0,.5),header.addChild(titleText),this.headerType){case"icon":var icon=game.add.image(this.width-12,0,this.headerIcon);icon.width=35,icon.height=icon.width,icon.anchor.set(1,.5),header.addChild(icon);break;case"food":var food=game.add.image(this.width-12,0,"food");food.width=30,food.height=food.width,food.anchor.set(1,.5),header.addChild(food);var foodCountText=game.add.text(food.x-food.width-10,3,global.getFoodCount()+"",{font:"bold 24px "+global.fontFamily,fill:color.get("dark-grey")});foodCountText.anchor.set(1,.5),header.addChild(foodCountText)}},Popup.prototype._initContainer=function(){var game=this.game,margin=this.paddingHorz;this.hasHeader&&(this.paddingTop=this.header.height);var container=game.add.image((game.width-this.width)/2+margin,game.height+this.paddingTop);this.containerHeight=this.height-this.paddingTop-this.paddingBottom,this.container=container,this.elements.push(container),this._initCrop()},Popup.prototype._initCrop=function(){var game=this.game,margin=this.paddingHorz,container=this.container,crop=this.game.add.graphics(0,0);crop.beginFill(16777215),crop.drawRect(container.x,game.height+this.paddingTop,this.width-2*margin,this.containerHeight),crop.endFill(),container.mask=crop,this.elements.push(crop)},Popup.prototype._initContent=function(){},Popup.prototype._setHeight=function(height){var originHeight=this.height,heightDiff=(this.height=height)-originHeight;this.main.height+=heightDiff,this.bottomEdge.y+=heightDiff,this.container.mask.destroy(),this.containerHeight+=heightDiff,this._initCrop()},Popup.prototype._show=function(){this.mask.show(500);var game=this.game,y=this.y;this.elements.forEach(function(el){game.add.tween(el).to({y:y-game.height+""},600,Phaser.Easing.Back.Out,!0)})},Popup.prototype._hide=function(tweenEnabled){this.mask.hide(500);var game=this.game,y=this.y;void 0===tweenEnabled&&(tweenEnabled=!0),tweenEnabled?this.elements.forEach(function(el){var move=game.add.tween(el).to({y:game.height-y+""},600,Phaser.Easing.Back.In);move.onComplete.add(function(){el.destroy()}),move.start()}):this.elements.forEach(function(el){el.destroy()})},Popup}),define("common/ui/Mask",function(require){var Mask=function(game,options){this.game=game,this.image=null,this.alpha=options.alpha?options.alpha:1,this.ease=Phaser.Easing.Quadratic.InOut,this.onTouch=options.onTouch?options.onTouch:null,this._init()};return Mask.prototype._init=function(){var game=this.game,image=game.add.image(0,0,"pixel-black");image.scale.set(game.width/image.width,game.height/image.height),image.alpha=this.alpha,image.inputEnabled=!0,this.image=image,this.onTouch&&this._bindTouch(this.onTouch)},Mask.prototype.show=function(duration,cb){if(duration){var show=this.game.add.tween(this.image).from({alpha:0},duration,this.ease);cb&&show.onComplete.add(cb),show.start()}else cb&&cb()},Mask.prototype.hide=function(duration,cb){if(duration){var hide=this.game.add.tween(this.image).to({alpha:0},duration,this.ease);hide.onComplete.add(function(){this._destroy(),cb&&cb()},this),hide.start()}else this.image.alpha=0,this._destroy(),cb&&cb()},Mask.prototype._bindTouch=function(onTouch){this.image.events.onInputUp.add(onTouch)},Mask.prototype._destroy=function(){this.image.destroy()},Mask}),define("common/ui/Confirm",function(require){var global=require("common/global"),color=require("common/color"),util=require("common/util"),Popup=require("common/ui/Popup"),Confirm=function(game,options){Popup.call(this,game,{hasHeader:!1,height:280,y:200}),this.text=options.text?options.text:"",this.onConfirm=options.onConfirm,this._init()};return util.inherits(Confirm,Popup),Confirm.prototype._initContent=function(){this._initText(),this._initBtns()},Confirm.prototype._initText=function(){var game=this.game,container=this.container,textText=game.add.text(this.containerWidth/2,40,this.text,{font:"28px "+global.fontFamily,fill:color.get("coffee"),align:"center"});textText.anchor.set(.5,0),textText.lineSpacing=10,container.addChild(textText)},Confirm.prototype._initBtns=function(){var game=this.game,container=this.container,btnConfirm=game.add.button(this.containerWidth/2+25,this.containerHeight,"btn-confirm",function(){this.onConfirm(),this._hide()},this);btnConfirm.anchor.set(0,1),util.addHover(btnConfirm),container.addChild(btnConfirm);var btnCancel=game.add.button(this.containerWidth/2-25-btnConfirm.width,this.containerHeight,"btn-confirm",function(){this._hide()},this);btnCancel.anchor.set(0,1),util.addHover(btnCancel),container.addChild(btnCancel);var fontStyle={font:"bold 30px "+global.fontFamily,fill:color.get("coffee")},confirmText=game.add.text(btnConfirm.width/2,-btnConfirm.height/2,"是",fontStyle);confirmText.anchor.set(.5),btnConfirm.addChild(confirmText);var cancelText=game.add.text(btnCancel.width/2,-btnCancel.height/2,"否",fontStyle);cancelText.anchor.set(.5),btnCancel.addChild(cancelText)},Confirm}),define("common/serverData",function(){var ajax=require("common/ajax"),url=require("common/url");return{load:function(keys,success,failure){ajax.get({url:url.LOAD_DATA,data:{key:keys.join(",")},success:success,failure:failure})},save:function(data,success,failure){ajax.post({url:url.SAVE_DATA,data:data,success:success,failure:failure})}}}),define("common/global",function(require){require("common/ajax"),require("common/url");var mode,foodCount,highest,selected,shared,nickname,signPackage,shareText,tryTimes,util=require("common/util"),serverData=require("common/serverData"),storageKey={foodCount:"ginger-food-count",highest:"ginger-highest",selected:"ginger-selected",unlocks:"ginger-unlocks",shared:"ginger-shared"},global={};return mode="dev",global.setMode=function(newMode){mode=newMode},global.getMode=function(){return mode},global.herosConfig=[{id:0,name:"boy",chName:"姜饼仔",color:"#f3a156",width:76,height:106,paddingRight:6,scale:.6,actions:{down:{fps:6},up:{fps:10},kick:{fps:15},walk:{fps:15}},unlockType:"free",cost:0,desc:"从烤箱中逃离出来，向着\n未知前方探索的姜饼仔",powerText:"我有我的勇气",power:{}},{id:1,name:"girl",chName:"姜饼妹",color:"#efbc58",width:85,height:112,paddingRight:4,scale:.6,actions:{down:{fps:6},up:{fps:10},kick:{fps:15},walk:{fps:15}},unlockType:"share",cost:0,desc:"哥哥出去闯了，有点放心\n不下呢，我也要加油！",powerText:"增加出现果果的几率",power:{foodProba:.6}},{id:2,name:"cupcake",chName:"杯糕小子",color:"#a0c8aa",width:110,height:137,paddingRight:12,scale:.5,actions:{down:{fps:5},up:{fps:6},kick:{fps:15},walk:{fps:12}},unlockType:"food",cost:50,desc:"为了传递爱与勇气而奔跑\n不息，锻炼出了蓬松味美\n的肌肉",powerText:"扩大糖浆的范围",power:{spotWidth:16}},{id:3,name:"baguette",chName:"法棍先生",color:"#ea7408",width:101,height:159,paddingRight:10,scale:.5,actions:{down:{fps:6},up:{fps:10},kick:{fps:15},walk:{fps:12}},unlockType:"food",cost:150,desc:"从香榭丽舍大街某小卖部\n走出的法式长棍，也在力\n争成为世界第一棍",powerText:"不会出现过窄的柱子",power:{stageMinWidth:36}},{id:4,name:"zongzi",chName:"粽子糖",color:"#d8e480",width:96,height:86,paddingRight:5,scale:.47,actions:{down:{fps:6},up:{fps:10},kick:{fps:15},walk:{fps:20}},unlockType:"food",cost:250,desc:"来自东方的神秘角色，虽\n然被称为糖，但是其内心\n是甜是咸还难下定论哦",powerText:"命中糖浆，双倍奖励",power:{spotMultiple:2}},{id:5,name:"donut",chName:"甜甜圈",color:"#543a22",width:90,height:112,paddingRight:10,scale:.5,actions:{down:{fps:6},up:{fps:10},kick:{fps:15},walk:{fps:15}},unlockType:"food",cost:350,desc:"永远一副惊讶表情的甜甜\n圈，说不定会给这个世界\n带来一些惊喜",powerText:"自动翻越小间隙",power:{stickExtraLength:14}},{id:6,name:"cone",chName:"蛋筒夫人",color:"#f55e82",width:109,height:190,paddingRight:15,scale:.5,actions:{down:{fps:5},up:{fps:15},kick:{fps:15},walk:{fps:15}},unlockType:"food",cost:500,desc:"发型贵气的蛋筒夫人看上\n去有些高冷，其实她的心\n很容易融化哟",powerText:"冷却棒棒的延长速度",power:{stickSpeed:6,stickTexture:"stick-cold"}},{id:7,name:"macaron",chName:"双生马卡龙",color:"#a0c8aa",width:105,height:128,paddingRight:8,scale:.45,actions:{down:{fps:6},up:{fps:6},kick:{fps:15},walk:{fps:12}},unlockType:"food",cost:800,desc:"别看个头小，兄妹齐心可\n是能迸发出惊人的力量呢",powerText:"一次重生机会，且第二次\n生命阶段不出现过窄柱子",power:{doubleLife:!0,nextLife:8}},{id:8,name:"macaron-sister",chName:"马卡龙妹妹",hidden:!0,color:"#a0c8aa",width:104,height:76,paddingRight:8,scale:.45,actions:{down:{fps:6},up:{fps:10},kick:{fps:15},walk:{fps:12}},power:{stageMinWidth:36,previousLife:7}}],global.getHeroConfig=function(){return global.herosConfig[global.getSelected()]},global.getStorage=function(keys){var storage={};return keys.forEach(function(key){storage[key]=localStorage.getItem(storageKey[key])}),storage},global.assignStorage=function(keys){keys.forEach(function(key){global["assign"+util.firstToUpperCase(key)]()})},global.initStorage=function(keys){keys.forEach(function(key){global["init"+util.firstToUpperCase(key)]()})},global.setStorage=function(obj){for(var key in obj)obj.hasOwnProperty(key)&&global["set"+util.firstToUpperCase(key)](obj[key],!1)},global.clearStorage=function(){for(var key in storageKey)storageKey.hasOwnProperty(key)&&localStorage.removeItem(storageKey[key])},global.fontFamily='"Helvetica Neue", Helvetica, STHeiTi, sans-serif',global.initFoodCount=function(count){foodCount=(foodCount=+localStorage.getItem(storageKey.foodCount))?+foodCount:2100},global.assignFoodCount=function(count){foodCount=count},global.getFoodCount=function(){return foodCount},global.setFoodCount=function(count,cb){count!==foodCount&&(localStorage.setItem(storageKey.foodCount,count),cb&&cb())},global.assignHighest=function(){highest=+localStorage.getItem(storageKey.highest)},global.initHighest=function(){global.setHighest(0)},global.getHighest=function(){return highest},global.setHighest=function(score,remote){highest=+score,void 0===remote&&(remote=!0),remote&&serverData.save({highest:highest}),localStorage.setItem(storageKey.highest,highest)},global.assignSelected=function(){selected=+localStorage.getItem(storageKey.selected)},global.initSelected=function(){global.setSelected(0)},global.getSelected=function(){return selected},global.setSelected=function(index,remote){selected=+index,void 0===remote&&(remote=!0),remote&&serverData.save({selected:selected}),localStorage.setItem(storageKey.selected,selected)},function(){var unlocks;function setUnlock(index,value){unlocks[index]=value,saveUnlocks()}function saveUnlocks(remote){var unlocksStr=JSON.stringify(unlocks);void 0===remote&&(remote=!0),remote&&serverData.save({unlocks:unlocksStr}),localStorage.setItem(storageKey.unlocks,unlocksStr)}global.assignUnlocks=function(){unlocks=JSON.parse(localStorage.getItem(storageKey.unlocks))},global.initUnlocks=function(){unlocks=[1];for(var i=1,len=global.herosConfig.length;i<len;++i)unlocks.push(0);saveUnlocks(unlocks)},global.getUnlock=function(index){return unlocks[index]},global.setUnlocks=function(newUnlocks,remote){unlocks=util.isArray(newUnlocks)?unlocks:JSON.parse(newUnlocks),saveUnlocks(remote)},global.unlock=function(index){setUnlock(index,1)},global.lock=function(index){setUnlock(index,0)}}(),global.assignShared=function(){shared=+localStorage.getItem(storageKey.shared)},global.initShared=function(){global.setShared(0)},global.getShared=function(){return shared},global.setShared=function(newShared,remote){shared=+newShared,void 0===remote&&(remote=!0),remote&&serverData.save({shared:shared}),localStorage.setItem(storageKey.shared,shared)},global.getNickname=function(){return nickname},global.setNickname=function(name){nickname=name},global.getSignPackage=function(){return signPackage},global.setSignPackage=function(obj){signPackage=obj},global.resetShareText=function(){shareText="【玩超能姜饼人 赢小米手机】快来一起勇闯甜点世界吧！"},global.getShareText=function(){return shareText},global.setShareText=function(text){shareText=text},tryTimes=0,global.resetTryTimes=function(){tryTimes=0},global.getTryTimes=function(){return tryTimes},global.addTryTimes=function(){++tryTimes},global}),define("common/color",function(require){var colors={bg:"#000",white:"#fff",black:"#000","dark-grey":"#555","darker-grey":"#333",chocolate:"#a45d35",beige:"#ffecb8","dark-beige":"#e1d0a1",coffee:"#554d36",yellow:"#ffcd43",cherry:"#ef6c65",orange:"#ffad5d"};return{get:function(color){return colors[color]}}}),define("common/ajax",function(require){return{toQuery:function(data){var query=[];for(var key in data)data.hasOwnProperty(key)&&query.push(encodeURIComponent(key)+"="+encodeURIComponent(data[key]));return query.join("&")},post:function(settings){var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){4===xhr.readyState&&(200===xhr.status?settings.success&&settings.success(xhr.responseText,xhr):settings.failure&&settings.failure(xhr.status,xhr))},xhr.open("POST",settings.url?settings.url:""),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send(this.toQuery(settings.data?settings.data:{}))},get:function(settings){var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){4===xhr.readyState&&(200===xhr.status?settings.success&&settings.success(xhr.responseText,xhr):settings.failure&&settings.failure(xhr.status,xhr))};var data=settings.data||{},url=settings.url||"";url+=-1===url.indexOf("?")?"?"+this.toQuery(data):"&"+this.toQuery(data),xhr.open("GET",url),xhr.send()}}}),define("boot",function(require){var global=require("common/global");return{preload:function(){var path,suffix;suffix="dev"===global.getMode()?(path="src/img/",".png"):(path="asset/img/",".png?v=1544715623"),this.game.load.spritesheet("boy-walk",path+"boy/walk"+suffix,76,106)},create:function(){var game=this.game;game.stage.backgroundColor=require("common/color").get("bg"),game.plugins.screenShake=game.plugins.add(Phaser.Plugin.ScreenShake),game.plugins.screenShake.setup({shakeX:!1,shakeY:!0,sensCoef:.3});var scale=this.scale;scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,scale.pageAlignHorizontally=!0,scale.pageAlignVertically=!0,setTimeout(function(){game.state.start("preload")},100)}}});